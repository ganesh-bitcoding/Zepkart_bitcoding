{% extends "../base2.html" %}
{% block title %}{{ user }} Products{% endblock %}
{% block start %}

<style>
  /* Vanilla modal styles (no Bootstrap needed) */
  .vmodal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);
    display:none;align-items:center;justify-content:center;z-index:1050}
  .vmodal{width:min(480px,92vw);background:#fff;border-radius:14px;
    box-shadow:0 15px 50px rgba(0,0,0,.25);overflow:hidden}
  .vmodal__header{padding:14px 18px;background:#dc3545;color:#fff;display:flex;align-items:center;justify-content:space-between}
  .vmodal__title{margin:0;font-size:1.05rem;font-weight:600}
  .vmodal__close{background:transparent;border:0;color:#fff;font-size:1.4rem;cursor:pointer;line-height:1}
  .vmodal__body{padding:18px;font-size:.95rem;color:#333}
  .vmodal__footer{padding:12px 18px;display:flex;gap:10px;justify-content:flex-end;background:#f7f7f8}
  .btn-v{border:0;border-radius:10px;padding:8px 14px;cursor:pointer}
  .btn-v-secondary{background:#e9ecef}
  .btn-v-danger{background:#dc3545;color:#fff}
  .btn-v-secondary:hover{filter:brightness(.96)}
  .btn-v-danger:hover{filter:brightness(.94)}
  .btn-group-responsive{display:flex;gap:8px;flex-wrap:wrap}
</style>

<div class="container mt-4">
  <div class="row g-4">
    {% for product in products %}
    <div class="col-md-4 col-sm-6 col-12 mb-4">
      <div class="card h-100 shadow-sm">
        <img src="{{ product.images.first.image.url }}" class="card-img-top" alt="{{ product.name }}">
        <div class="card-body">
          <h5 class="card-title">{{ product.name }}</h5>
          <p class="card-text"><span class="badge bg-warning text-dark">{{ product.category }}</span></p>
          <p class="card-text">{{ product.price }}</p>
          <div class="btn-group-responsive">
            <a href="{% url 'DetailedProduct' product.id %}" class="card-btn btn btn-sm btn-info">View</a>
            <a href="{% url 'UpdateProduct' product.id %}" class="card-btn btn btn-sm btn-warning">Update</a>

            <!-- Delete trigger (no direct link) -->
            <button
              type="button"
              class="card-btn btn btn-sm btn-danger js-open-delete"
              data-delete-url="{% url 'DeleteProduct' product.id %}"
              data-product-name="{{ product.name|escape }}">
              Delete
            </button>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<!-- One reusable vanilla modal -->
<div class="vmodal-backdrop" id="deleteBackdrop" aria-hidden="true">
  <div class="vmodal" role="dialog" aria-modal="true" aria-labelledby="vmodalTitle">
    <div class="vmodal__header">
      <h5 class="vmodal__title" id="vmodalTitle">Confirm Delete</h5>
      <button class="vmodal__close" type="button" aria-label="Close" id="vmClose">&times;</button>
    </div>
    <div class="vmodal__body">
      <p id="vmText">Are you sure you want to delete this product?</p>
    </div>
    <div class="vmodal__footer">
      <button class="btn-v btn-v-secondary" type="button" id="vmCancel">Cancel</button>
      <a class="btn-v btn-v-danger" id="vmConfirm" href="#">Yes, Delete</a>
    </div>
  </div>
</div>

<script>
  (function () {
    const backdrop = document.getElementById('deleteBackdrop');
    const vmText   = document.getElementById('vmText');
    const vmCancel = document.getElementById('vmCancel');
    const vmClose  = document.getElementById('vmClose');
    const vmConfirm= document.getElementById('vmConfirm');

    function openModal(name, url){
      vmText.textContent = `Are you sure you want to delete "${name}"?`;
      vmConfirm.setAttribute('href', url);
      backdrop.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }
    function closeModal(){
      backdrop.style.display = 'none';
      document.body.style.overflow = '';
    }

    // Open on any delete button
    document.addEventListener('click', function(e){
      const btn = e.target.closest('.js-open-delete');
      if(!btn) return;
      const url = btn.getAttribute('data-delete-url');
      const name = btn.getAttribute('data-product-name') || 'this product';
      openModal(name, url);
    });

    // Close controls
    vmCancel.addEventListener('click', closeModal);
    vmClose.addEventListener('click', closeModal);
    backdrop.addEventListener('click', function(e){
      if(e.target === backdrop) closeModal(); // click outside modal closes
    });

    // Optional: ESC key closes
    document.addEventListener('keydown', function(e){
      if(e.key === 'Escape' && backdrop.style.display === 'flex') closeModal();
    });
  })();
</script>

{% endblock %}
